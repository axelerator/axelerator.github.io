<!doctype html>
<html lang="en" domain="blog.axelerator.de" >
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="/assets/js/highlight/styles/default.css">
    <link rel="stylesheet" href="/assets/css/tufte.min.css"/>
    <link rel="stylesheet" href="/assets/css/styles.css"/>
    <link rel="icon" type="image/png" href="/favicon.png">
    <title>Episode 9: Preventing invalid movements</title>
  </head>
  <body class="tetris-limit-movement">
    <header>
      <div id="bg">axelerator.de</div>
      <nav>
  <div class="pages">
  
    <div><a href="/">Home</a></div>
  
    <div><a href="/about">About</a></div>
  
  </div>
  <div class="links">
    <a href="/feed.xml"><span class="rss"/></a>
    <a href="https://twitter.com/TheAxelerator"><span class="twitter"/></a>
    <a rel="me" href="https://hachyderm.io/@axelerator"><span class="fediverse"/></a>
    <a href="https://github.com/axelerator"><span class="github"/></a>
    <a href="https://www.linkedin.com/in/axel-tetzlaff"><span class="linkedin"/></a>
    <a href="https://www.youtube.com/channel/UCQFzW6LFfreLOYI9-3QV2xg"><span class="youtube"/></a>
    <a href="https://www.twitch.tv/programmingisfun"><span class="twitch"/></a>
  </div>
  <div id="lang-picker">
    <label class="current" for="lang-toggle">ðŸ‡ºðŸ‡¸</label>
    <input type="checkbox" id="lang-toggle">
    <ul>
      
      
        
          <li>
            <a href="/elm/de/tetris-limit-movement" class="de">ðŸ‡©ðŸ‡ª</a>
          </li>
        
      
        
      
    </ul>

  </div>

</nav>




    </header>
    <main>
     <article>
       <h1>Episode 9: Preventing invalid movements</h1>
       <div class="meta"> 
  <div title="Reading time">3 minutes</div>
  <div>
  
    
    <a href="/tags#elm">#elm</a>
  
  </div>
  <div>11 September 2021</div>
</div>


<section>
<p>In <a href="https://www.youtube.com/watch?v=ZacgfAavKzQ">episode 9 (48min)</a> I make sure the current piece canâ€™t be moved out of the board or into other pieces. With that came the opportunity to do a little functional finger exercise and develop a function that swaps the arguments of another function.</p>

<p>The state of the code can be found on the <a href="https://github.com/axelerator/elm-tetris/tree/episode9">episode9 branch</a>.
Or you can have a look at the <a href="https://github.com/axelerator/elm-tetris/commit/c9e1d2564626e3584e96500ee210ad14a7a9b1c4">commit</a> if you just want to see whatâ€™s changed.</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/ZacgfAavKzQ" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>

<ol>
  <li><a href="#canmove">Movement allowed?</a></li>
  <li><a href="#curry">Excursion <em>Currying</em></a></li>
</ol>

<h3 id="-movement-allowed"><a name="canmove"></a> Movement allowed?</h3>

<p>The entry point for this weekâ€™s changes was the <a href="https://github.com/axelerator/elm-tetris/blob/episode8/src/Main.elm#L222"><code class="language-plaintext highlighter-rouge">movePiece</code> function</a>. The goal was to extend the logic in a way that would prevent invalid moves.</p>

<p>With nearly 50 lines of code, the <code class="language-plaintext highlighter-rouge">movePiece</code> function was already quite long, to begin with. But with the application of a few basic syntax elements, we were able to keep the length at that despite adding the new logic.</p>

<p>The definition of what I understand to constitute a valid move is as follows:</p>

<blockquote>
  <p>All fields the current piece <strong>would</strong> occupy on the board must be empty.
If thatâ€™s not the case, donâ€™t execute the move</p>
</blockquote>

<p>The significant change of the code looks like this:</p>

<pre><code class="language-Elm">movePiece : Key -&gt; Model -&gt; Model
movePiece key model =
  ...
  let
      canMove =
          all ((==) (Just Empty)) &lt;|
              map (flip lookUp model.board) &lt;|
                  occupiedPositions movedPiece
  in
  if canMove then
      { model | currentPiece = Just movedPiece }

  else
      model
</code></pre>

<p>One sign of high software quality is in my opinion when the â€˜natural mental modelâ€™ can be read directly from the code
From my point of view Elm offers many ways to combine expressions in a way that brings us close to this goal.</p>

<p>If we read the calculation of <code class="language-plaintext highlighter-rouge">canMove</code> from the bottom up, <code class="language-plaintext highlighter-rouge">canMove</code> is true if:</p>

<ul>
  <li>the positions the current piece would occupy (<code class="language-plaintext highlighter-rouge">occupiedPositions movedPiece</code>)</li>
  <li>transformed into the state of the field on the board (<code class="language-plaintext highlighter-rouge">map (flip lookUp model.board)</code>)</li>
  <li>are all empty (<code class="language-plaintext highlighter-rouge">all ((==) (Just Empty))</code>)</li>
</ul>

<h3 id="-excursion-currying"><a name="curry"></a> Excursion <em>Currying</em></h3>

<p>I discovered functional programming thanks to my professor <a href="https://github.com/UweSchmidt">Uwe Schmidt</a> at university.
But the theoretical groundwork for it only partly managed to persist in my brain. What led to me fumbling a bit for words when it came to explain what concepts I was making use of when I developed the <a href="https://github.com/axelerator/elm-tetris/blob/episode9/src/Main.elm#L250"><code class="language-plaintext highlighter-rouge">flip</code> function</a></p>

<p>Thatâ€™s why Iâ€™d like to spend a few lines here to make up for the lack of explanation. In the <a href="https://blog.axelerator.de/elm/en/board">previous episodes</a> I made use of partial function application quite a bit.</p>

<p><em>Currying</em> describes a process to transform a function in a way that <strong>every</strong> parameter can be called/bound separately. In some languages like Elm and Haskell functions are automatically curried.</p>

<p>But currying is also possible in languages that donâ€™t have it build in, for example in JavaScript
However, we do have to explicitly rewrite our function definition and how we call the function.</p>

<pre><code class="language-Javascript">// not curried
function addAndMultiply(a, b, times) {
  return (a + b) * times;
}

// curried
function addAndMultiplyCurried(a) {
  return function(b) {
    return function(times) {
      return (a + b) * times;
    }
  }
}

// curried ES6
const addAndMultiplyCurriedES6 = 
  (a) =&gt; 
    (b) =&gt; 
      (times) =&gt; (a + b) * times;

// same result
addAndMultiply(1,2,3) == addAndMultiplyCurried(1)(2)(3)
</code></pre>

<p>Functions that are <em>curried</em> are more versatile. That is mainly for their ability to use them with partial function application, of which we made use multiple times already in our little Tetris program.</p>

<p>The use of currying alone does not make a program automatically X% better. I would even argue that in languages that require an extra effort to rewrite a function itâ€™s not worth it.
However in languages where it comes for free out of the box, it quickly becomes a tool you donâ€™t want to miss. And the larger a software project grows the more even those little optimization pay off.</p>

<p>One â€˜fun factâ€™ one must mention when talking about <em>currying</em> is how itâ€™s got its name. Itâ€™s based on the work of <a href="https://en.wikipedia.org/wiki/Haskell_Curry">Haskell Curry</a>. An American logician who took great inspiration from <a href="https://en.wikipedia.org/wiki/Moses_Sch%C3%B6nfinkel">Moses SchÃ¶nfinkel</a>s concept of <a href="https://en.wikipedia.org/wiki/Combinatory_logic">combinatory logic</a>. So strictly speaking it should be called <em>schÃ¶nfinkeling</em> - but that just does not roll off the tongue as easily I guess.</p>


</section>

<div id="remark42"></div>
<script>
  var remark_config = {
    host: 'https://comments.axelerator.de',
    site_id: 'comments',
  }
</script>
<script>!function(e,n){for(var o=0;o<e.length;o++){var r=n.createElement("script"),c=".js",d=n.head||n.body;"noModule"in r?(r.type="module",c=".mjs"):r.async=!0,r.defer=!0,r.src=remark_config.host+"/web/"+e[o]+c,d.appendChild(r)}}(remark_config.components||["embed"],document);</script>


     </article>
    </main>
  </body>
  <script src="/assets/js/highlight/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <script data-goatcounter="https://goatcounter.axelerator.de/count"
        async src="//goatcounter.axelerator.de/count.js"></script>
</html>

